# DocAvailable APK Build Guide

This guide explains how to build APK files for the DocAvailable app and how to handle updates when changes are made.

## Prerequisites

1. **Node.js and npm** - Latest LTS version
2. **Java Development Kit (JDK)** - Version 11 or higher
3. **Android Studio** - For Android SDK and build tools
4. **Android SDK** - API level 21 or higher
5. **React Native CLI** - `npm install -g @react-native-community/cli`

## Quick Start

### Option 1: Using Build Scripts (Recommended)

#### Windows:
```bash
# Run the interactive build script
build-apk.bat
```

#### Unix/Linux/macOS:
```bash
# Make the script executable (first time only)
chmod +x build-apk.sh

# Run the interactive build script
./build-apk.sh
```

### Option 2: Using npm Scripts

```bash
# Build debug APK (for testing)
npm run build:apk-debug

# Build release APK (for production)
npm run build:apk

# Build Android App Bundle (for Play Store)
npm run build:apk-bundle

# Clean Android build
npm run clean:android
```

### Option 3: Using Expo CLI

```bash
# Build for Android
expo run:android

# Build release variant
expo run:android --variant release
```

## APK Types and Their Purposes

### 1. Debug APK
- **Purpose**: Development and testing
- **Features**: 
  - Live reload enabled
  - Debugging tools available
  - Larger file size
  - Can be installed alongside release version
- **Location**: `android/app/build/outputs/apk/debug/app-debug.apk`

### 2. Release APK
- **Purpose**: Production distribution
- **Features**:
  - Optimized and minified
  - Smaller file size
  - No debugging information
  - Signed for distribution
- **Location**: `android/app/build/outputs/apk/release/app-release.apk`

## Handling Updates

### Method 1: Full APK Updates (Traditional)
When you make changes to your app:

1. **Update version numbers** in `android/app/build.gradle`:
   ```gradle
   defaultConfig {
       versionCode 2  // Increment this
       versionName "1.0.1"  // Update this
   }
   ```

2. **Build new APK**:
   ```bash
   npm run build:apk
   ```

3. **Distribute the new APK** to users

### Method 2: Over-the-Air (OTA) Updates (Recommended)
For JavaScript/React Native code changes without native code changes:

1. **Install Expo Updates**:
   ```bash
   npx expo install expo-updates
   ```

2. **Configure OTA updates** in `app.config.js`:
   ```javascript
   export default {
     expo: {
       // ... other config
       updates: {
         enabled: true,
         fallbackToCacheTimeout: 0,
         url: "https://your-update-server.com"
       }
     }
   };
   ```

3. **Publish updates**:
   ```bash
   expo publish
   ```

### Method 3: CodePush Integration
For more advanced OTA updates:

1. **Install CodePush**:
   ```bash
   npm install react-native-code-push
   ```

2. **Configure CodePush** in your app
3. **Deploy updates** without rebuilding APK

## Version Management

### Automatic Version Increment
Create a script to automatically increment version numbers:

```bash
# scripts/increment-version.sh
#!/bin/bash
# This script automatically increments the version code
# Usage: ./scripts/increment-version.sh [patch|minor|major]

# Read current version from build.gradle
CURRENT_VERSION=$(grep "versionName" android/app/build.gradle | sed 's/.*versionName "\(.*\)".*/\1/')
CURRENT_CODE=$(grep "versionCode" android/app/build.gradle | sed 's/.*versionCode \([0-9]*\).*/\1/')

echo "Current version: $CURRENT_VERSION (code: $CURRENT_CODE)"
echo "Incrementing version..."

# Increment version code
NEW_CODE=$((CURRENT_CODE + 1))

# Update build.gradle
sed -i "s/versionCode $CURRENT_CODE/versionCode $NEW_CODE/" android/app/build.gradle

echo "Version updated to code: $NEW_CODE"
```

## Signing Configuration

### Debug Signing (Default)
Uses the debug keystore automatically generated by Android Studio.

### Release Signing
For production releases, create a release keystore:

1. **Generate keystore**:
   ```bash
   keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
   ```

2. **Configure in `android/gradle.properties`**:
   ```properties
   MYAPP_UPLOAD_STORE_FILE=my-release-key.keystore
   MYAPP_UPLOAD_KEY_ALIAS=my-key-alias
   MYAPP_UPLOAD_STORE_PASSWORD=*****
   MYAPP_UPLOAD_KEY_PASSWORD=*****
   ```

3. **Update `android/app/build.gradle`** to use release signing config

## Troubleshooting

### Common Issues

1. **Build fails with "SDK not found"**:
   - Ensure Android SDK is properly installed
   - Set ANDROID_HOME environment variable
   - Install required SDK platforms and build tools

2. **"Gradle daemon" issues**:
   ```bash
   cd android
   ./gradlew --stop
   ./gradlew clean
   ```

3. **"Metro bundler" issues**:
   ```bash
   npx react-native start --reset-cache
   ```

4. **"Keystore" issues**:
   - Ensure keystore file exists and is in the correct location
   - Verify keystore passwords are correct

### Performance Optimization

1. **Enable Hermes** (already configured):
   - Reduces app size and improves performance

2. **Enable ProGuard** for release builds:
   - Minifies code and removes unused code

3. **Enable resource shrinking**:
   - Removes unused resources

## Distribution

### Internal Testing
- Share APK files directly with testers
- Use Google Drive, Dropbox, or similar services

### Google Play Store
- Build Android App Bundle: `npm run build:apk-bundle`
- Upload to Google Play Console
- Follow Google Play Store guidelines

### Alternative Stores
- Amazon Appstore
- Samsung Galaxy Store
- Huawei AppGallery

## Best Practices

1. **Always test on real devices** before distribution
2. **Use different version codes** for each release
3. **Keep backup of signing keys** in a secure location
4. **Document changes** in release notes
5. **Test OTA updates** thoroughly before publishing
6. **Monitor crash reports** after release

## Automation

### CI/CD Integration
Consider setting up automated builds using:
- GitHub Actions
- GitLab CI
- Jenkins
- Bitrise

### Automated Versioning
Use tools like:
- `standard-version`
- `semantic-release`
- Custom scripts

## Support

For issues related to:
- **Build process**: Check Android Studio and Gradle logs
- **App functionality**: Test on different devices and Android versions
- **Distribution**: Refer to store-specific guidelines
